# è®¾è®¡æ–‡æ¡£
---
# ç›®å½•

- [è®¾è®¡æ–‡æ¡£](#è®¾è®¡æ–‡æ¡£)
- [ç›®å½•](#ç›®å½•)
- [0. é…ç½®å’Œä¾èµ–](#0-é…ç½®å’Œä¾èµ–)
  - [0.1 `docker-compose` æ–‡ä»¶](#01-docker-compose-æ–‡ä»¶)
  - [0.2 ä¸ºä»€ä¹ˆæœ‰çš„åœ¨ `docker-compose.yml`ï¼Œæœ‰çš„å•ç‹¬å†™ `.yaml`ï¼Ÿ](#02-ä¸ºä»€ä¹ˆæœ‰çš„åœ¨-docker-composeymlæœ‰çš„å•ç‹¬å†™-yaml)
  - [0.3 ç«¯å£å…¨è§ˆ](#03-ç«¯å£å…¨è§ˆ)
  - [0.4  å±‚çº§å…³ç³»å›¾](#04--å±‚çº§å…³ç³»å›¾)
---

# 0. é…ç½®å’Œä¾èµ–

## 0.1 `docker-compose` æ–‡ä»¶

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåŒ…å«å››ä¸ªæœåŠ¡çš„é›†ç¾¤ï¼š

1. **Spark Masterï¼ˆä¸»èŠ‚ç‚¹ï¼‰**
2. **Spark Workerï¼ˆå·¥ä½œèŠ‚ç‚¹ï¼‰**
3. **Redisï¼ˆå†…å­˜æ•°æ®å­˜å‚¨ï¼‰**
4. **MinIOï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰**

æ¯ä¸ªæœåŠ¡éƒ½ä½¿ç”¨ä¸€ä¸ªé•œåƒï¼ˆimageï¼‰æ¥åˆ›å»ºå®¹å™¨ã€‚

- **spark-master** å’Œ **spark-worker** éƒ½ä½¿ç”¨ `bitnami/spark:latest` é•œåƒã€‚
  é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½® Spark çš„è¿è¡Œæ¨¡å¼ï¼ˆmaster æˆ– workerï¼‰ï¼Œå¹¶å…³é—­è®¤è¯ä¸åŠ å¯†ä»¥ç®€åŒ–å¼€å‘ç¯å¢ƒã€‚
  `spark-worker` é€šè¿‡ `SPARK_MASTER_URL` æŒ‡å®šè¿æ¥åˆ° master èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡ `depends_on` ç¡®ä¿ master å…ˆå¯åŠ¨ã€‚

- **redis** ä½¿ç”¨ `redis:alpine` é•œåƒï¼Œæš´éœ²é»˜è®¤ç«¯å£ 6379ã€‚

- **minio** ä½¿ç”¨ `minio/minio` é•œåƒï¼Œæš´éœ²ç«¯å£ 9000ï¼ˆAPIï¼‰å’Œ 9001ï¼ˆæ§åˆ¶å°ï¼‰ï¼Œå¹¶è®¾ç½®é»˜è®¤çš„ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ã€‚

å½“åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
docker-compose up
````

å®ƒä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. å¯åŠ¨å†…éƒ¨è™šæ‹Ÿç½‘ç»œ
2. æ‹‰å–æ‰€éœ€é•œåƒï¼ˆSpark, Redis, MinIOï¼‰
3. æŒ‰ä¾èµ–é¡ºåºå¯åŠ¨å®¹å™¨

   * å¯åŠ¨ `spark-master`
   * å¯åŠ¨ `spark-worker`
   * å¯åŠ¨ Redis å’Œ MinIO
4. å»ºç«‹å®¹å™¨é—´äº’è”
5. å½¢æˆä¸€ä¸ª **å°å‹åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒ**

å¯åŠ¨åè®¿é—®å…¥å£

| è®¿é—®ç‚¹                                            | åŠŸèƒ½è¯´æ˜          |
| :--------------------------------------------- | :------------ |
| [http://localhost:8080](http://localhost:8080) | Spark Web æ§åˆ¶å° |
| [http://localhost:9001](http://localhost:9001) | MinIO ç®¡ç†æ§åˆ¶å°   |
| Redis å®¢æˆ·ç«¯è¿æ¥ `localhost:6379`                   | æŸ¥çœ‹ç¼“å­˜æ•°æ®        |


## 0.2 ä¸ºä»€ä¹ˆæœ‰çš„åœ¨ `docker-compose.yml`ï¼Œæœ‰çš„å•ç‹¬å†™ `.yaml`ï¼Ÿ

è¿™å…¶å®æ˜¯ä¸¤ç§ä¸åŒå±‚çº§çš„ç¼–æ’ç³»ç»Ÿï¼š

| å±‚çº§                  | æ–‡ä»¶                                | ç”¨é€”        | èŒƒå›´   |
| :------------------ | :-------------------------------- | :-------- | :--- |
| ğŸ³ Docker Compose   | `docker-compose.yml`              | æœ¬åœ°å¼€å‘ã€æµ‹è¯•   | å•å°æœºå™¨ |
| â˜¸ï¸ Kubernetes (K8s) | `deployment.yaml`, `service.yaml` | é›†ç¾¤éƒ¨ç½²ã€ç”Ÿäº§ç¯å¢ƒ | å¤šå°æœºå™¨ |


ğŸ³ Docker Compose é€‚åˆï¼š

* æœ¬åœ°å¿«é€Ÿèµ·ç¯å¢ƒ
* ä¸€é”®å¯åŠ¨å¤šä¸ªæœåŠ¡ï¼ˆ`docker-compose up`ï¼‰
* æ¨¡æ‹Ÿåˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆSparkã€Redisã€MinIOï¼‰

Compose å°±åƒæ˜¯ä¸€ä¸ª **è¿·ä½ ç‰ˆ Kubernetes**ï¼Œ
å¯ä»¥åœ¨å¼€å‘æœºä¸Šæ¨¡æ‹Ÿé›†ç¾¤è¡Œä¸ºã€‚



â˜¸ï¸ Kubernetes é€‚åˆï¼š

* ç”Ÿäº§ç¯å¢ƒ / äº‘ç«¯é›†ç¾¤
* è‡ªåŠ¨æ‰©å®¹ / è´Ÿè½½å‡è¡¡
* æœåŠ¡éš”ç¦»ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†

åœ¨ Kubernetes ä¸­ï¼Œæ¯ä¸ªç»„ä»¶å•ç‹¬å®šä¹‰ï¼š

* **Deployment**ï¼šå®šä¹‰è¿è¡Œçš„å‰¯æœ¬æ•°é‡ã€é•œåƒ
* **Service**ï¼šå®šä¹‰ç«¯å£æš´éœ²å’Œè®¿é—®è§„åˆ™
* **ConfigMap / Secret**ï¼šé…ç½®ä¸å¯†é’¥
* **Ingress**ï¼šå¤–éƒ¨è®¿é—®å…¥å£


## 0.3 ç«¯å£å…¨è§ˆ

| æ¨¡å—                       | ç¯å¢ƒ           | å¤–éƒ¨è®¿é—®ç«¯å£            | å®¹å™¨å†…éƒ¨ç«¯å£            | ç”¨é€”                 |
| :----------------------- | :----------- | :---------------- | :---------------- | :----------------- |
| **Spark Master**         | Docker       | 8080              | 8080              | Web æ§åˆ¶å°            |
|                          | Docker       | 7077              | 7077              | Worker ä¸ Master é€šä¿¡ |
| **Spark Worker**         | Docker       | -                 | -                 | ä¸æš´éœ²å¤–éƒ¨ç«¯å£            |
| **Redis**                | Docker / K8s | 6379              | 6379              | ç¼“å­˜æ•°æ®åº“              |
| **MinIO**                | Docker       | 9000              | 9000              | å¯¹è±¡å­˜å‚¨ API           |
|                          | Docker       | 9001              | 9001              | ç®¡ç†ç•Œé¢               |
| **API Gateway (Rust)**   | Docker       | 8080              | 8080              | æœåŠ¡ç½‘å…³               |
|                          | K8s          | 80 (Service.port) | 8080 (targetPort) | é›†ç¾¤å…¥å£               |
| **Inference (Python)**   | Docker / K8s | 3000              | 3000              | æ¨¡å‹æ¨ç†               |
| **Prometheus / Grafana** | K8s          | 9090 / 3000       | 9090 / 3000       | ç›‘æ§ç³»ç»Ÿ UI            |

## 0.4  å±‚çº§å…³ç³»å›¾

```
ğŸ§  åº”ç”¨å±‚ï¼ˆFastAPI / Rust / PyTorch / Sparkï¼‰
   â†“
ğŸ³ å®¹å™¨å±‚ï¼ˆDocker Containerï¼‰
   â†“
â˜¸ï¸ Pod å±‚ï¼ˆKubernetes å°†å®¹å™¨æ‰“åŒ…åœ¨ä¸€èµ·ï¼‰
   â†“
ğŸŒ èŠ‚ç‚¹å±‚ï¼ˆNodeï¼šå®é™…è¿è¡Œçš„æœºå™¨ï¼‰
   â†“
ğŸ–¥ï¸ é›†ç¾¤å±‚ï¼ˆKubernetes Clusterï¼‰

```




